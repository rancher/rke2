#!/usr/bin/env bash
set -ex

cd $(dirname $0)/..

source ./scripts/version.sh

./scripts/build-image-kubernetes
./scripts/build-image-runtime

awk '{print $1}' << EOF > build/images-core.txt
    ${REGISTRY}/${REPO}/${PROG}-runtime:${DOCKERIZED_VERSION}
    ${REGISTRY}/${REPO}/hardened-kubernetes:${KUBERNETES_VERSION}
EOF
echo "docker.io/${REPO}/${PROG}-runtime:${DOCKERIZED_VERSION}" >> build/images.txt
echo "docker.io/${REPO}/hardened-kubernetes:${DOCKERIZED_VERSION}" >> build/images.txt
docker image save --output build/images/${PROG}-airgap.tar $(<build/images.txt)

./scripts/build-image-test
